Script started on 2024-10-23 15:50:09+03:00 [TERM="xterm-256color" TTY="/dev/pts/0" COLUMNS="204" LINES="55"]
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ htopsudo apt-get install htophtop[K[Kdf -h
[?2004lFilesystem                         Size  Used Avail Use% Mounted on
tmpfs                              593M  2.2M  590M   1% /run
/dev/mapper/ubuntu--vg-ubuntu--lv  121G   40G   77G  34% /
tmpfs                              2.9G     0  2.9G   0% /dev/shm
tmpfs                              5.0M  4.0K  5.0M   1% /run/lock
tmpfs                              2.9G     0  2.9G   0% /run/qemu
/dev/sda2                          2.0G  323M  1.5G  18% /boot
ubuntu                             477G  338G  139G  71% /media/sf_ubuntu
tmpfs                              1.0M     0  1.0M   0% /var/snap/lxd/common/ns
tmpfs                              593M  136K  592M   1% /run/user/1000
/dev/sr0                            52M   52M     0 100% /media/rsshabanov/VBox_GAs_7.0.20
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ unmount [7m/media/rsshabanov/VBox_GAs_7.0.20[27m/media/rsshabanov/VBox_GAs_7.0.20
[?2004lbash: unmount: command not found
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ umount [7m/media/rsshabanov/VBox_GAs_7.0.20[27m/media/rsshabanov/VBox_GAs_7.0.20
[?2004l[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ df -g
[?2004ldf: invalid option -- 'g'
Try 'df --help' for more information.
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ df -h
[?2004lFilesystem                         Size  Used Avail Use% Mounted on
tmpfs                              593M  1.9M  591M   1% /run
/dev/mapper/ubuntu--vg-ubuntu--lv  121G   40G   77G  34% /
tmpfs                              2.9G     0  2.9G   0% /dev/shm
tmpfs                              5.0M  4.0K  5.0M   1% /run/lock
tmpfs                              2.9G     0  2.9G   0% /run/qemu
/dev/sda2                          2.0G  323M  1.5G  18% /boot
ubuntu                             477G  338G  139G  71% /media/sf_ubuntu
tmpfs                              1.0M     0  1.0M   0% /var/snap/lxd/common/ns
tmpfs                              593M  136K  592M   1% /run/user/1000
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [7mpython3 -m venv ansible-venv[27m
[7msource ansible-venv/bin/activate[27m
[7mpip install ansible[27m
[7mansible-galaxy collection install kubernetes.core[27m[A[A[Apython3 -m venv ansible-venv
source ansible-venv/bin/activate
pip install ansible
ansible-galaxy collection install kubernetes.core
[?2004lThe virtual environment was not created successfully because ensurepip is not
available.  On Debian/Ubuntu systems, you need to install the python3-venv
package using the following command.

    apt install python3.10-venv

You may need to use sudo with that command.  After installing the python3-venv
package, recreate your virtual environment.

Failing command: /home/rsshabanov/codeby-devops/exam/src/ansible-venv/bin/python3

bash: ansible-venv/bin/activate: No such file or directory
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: ansible in /home/rsshabanov/.local/lib/python3.10/site-packages (10.5.0)
Requirement already satisfied: ansible-core~=2.17.5 in /home/rsshabanov/.local/lib/python3.10/site-packages (from ansible) (2.17.5)
Requirement already satisfied: resolvelib<1.1.0,>=0.5.3 in /home/rsshabanov/.local/lib/python3.10/site-packages (from ansible-core~=2.17.5->ansible) (1.0.1)
Requirement already satisfied: jinja2>=3.0.0 in /usr/lib/python3/dist-packages (from ansible-core~=2.17.5->ansible) (3.0.3)
Requirement already satisfied: packaging in /usr/lib/python3/dist-packages (from ansible-core~=2.17.5->ansible) (21.3)
Requirement already satisfied: cryptography in /usr/lib/python3/dist-packages (from ansible-core~=2.17.5->ansible) (3.4.8)
Requirement already satisfied: PyYAML>=5.1 in /usr/lib/python3/dist-packages (from ansible-core~=2.17.5->ansible) (5.4.1)
Starting galaxy collection install process
Nothing to do. All requested collections are already installed. If you want to reinstall them, consider using `--force`.
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ 
[?2004l[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ 
[?2004l[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ 
[?2004l[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ cat Jenkinsfile 
[?2004lpipeline {
    agent any

    environment {
        appVersion = readFile('exam/src/VERSION').trim()
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'exam', url: 'https://github.com/Roma-uuu/codeby-devops.git'
            }
        }
        stage('Build') {
            steps {
                dir('exam/src') {
                    sh 'mvn clean package -Dcheckstyle.skip=true'
                }
            }
        }
        stage('Test Docker Access') {
            steps {
                sh 'docker info'
            }
        }
        stage('Build and Push Docker Image') {
            steps {
                dir('exam/src') {
                    script {
                        echo "Building Docker image with tag: ${appVersion}"
                        withCredentials([usernamePassword(credentialsId: 'dockerhub-credentials', usernameVariable: 'DOCKERHUB_USERNAME', passwordVariable: 'DOCKERHUB_TOKEN')]) {
                            sh """
                            echo $DOCKERHUB_TOKEN | docker login -u $DOCKERHUB_USERNAME --password-stdin
                            docker build -t apkerigz/devops:${appVersion} .
                            docker push apkerigz/devops:${appVersion}
                            """
                        }
                    }
                }
            }
        }
        stage('Deploy using Helm') {
            steps {
                withCredentials([string(credentialsId: 'k8s-sa-token', variable: 'K8S_TOKEN')]) {
                    dir('exam/src/mychart') {
                        script {
                            echo "Deploying Helm chart with image tag: ${appVersion}"
                            sh """
                            helm upgrade --install petclinic-app . \
                                --set image.repository=apkerigz/devops \
                                --set image.tag=${appVersion} \
                                --kube-token=$K8S_TOKEN
                            """
                        }
                    }
                }
            }
        }
        stage('Run Ansible Playbook') {
            steps {
                dir('exam/src') {
                    script {
                        // –î–æ–±–∞–≤–ª—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø–ª–µ–π–±—É–∫–∞
                        sh 'ansible-galaxy collection install kubernetes.core'
                        // –ó–∞–ø—É—Å–∫ —Å–∞–º–æ–≥–æ –ø–ª–µ–π–±—É–∫–∞
                        sh 'ansible-playbook -i inventory monitoring_playbook.yml --ask-become-pass'
                    }
                }
            }
        }
    }
}
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [7mansible-config dump | grep COLLECTIONS_PATHS[27m
[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cansible-config dump | grep COLLECTIONS_PATHS
[A
[?2004l[01;31m[KCOLLECTIONS_PATHS[m[K(default) = ['/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections']
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ ls -la [7mrsshabanov@MSK-01:~/codeby-devops/exam/src$ ansible-config dump | grep COLLECTIONS_PATHS[27m
[7mCOLLECTIONS_PATHS(default) = ['/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections'][27m
[A[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Crsshabanov@MSK-01:~/codeby-devops/exam/src$ ansible-config dump | grep COLLECTIONS_PATHS
COLLECTIONS_PATHS(default) = ['/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections']
[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections']                                                                 [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collect[1Pions'][A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collecti[1Pons'][A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collectio[1Pns'][A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collection[1Ps'][A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections[1P'][A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections'[1P][A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections'] [A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/home/rsshabanov/.ansible/collections', '/usr/share/ansible/collections']  [A]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P

[K[A[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1P[1@l[1@s[1@ [1@-[1@l[1@a[1@ [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P[1P '/usr/share/ansible/collections'][1P'/usr/share/ansible/collections'][1P/usr/share/ansible/collections'][1Pusr/share/ansible/collections'][1Psr/share/ansible/collections'][1Pr/share/ansible/collections'][1P/share/ansible/collections'][1Pshare/ansible/collections'][1Phare/ansible/collections'][1Pare/ansible/collections'][1Pre/ansible/collections'][1Pe/ansible/collections'][1P/ansible/collections'][1Pansible/collections'][1Pnsible/collections'][1Psible/collections'][1Pible/collections'][1Pble/collections'][1Ple/collections'][1Pe/collections'][1P/collections'][1Pcollections'][1Pollections'][1Pllections'][C[1Pections'][1Pections'][1Pctions'][1Ptions'][1Pions'][1Pons'][1Pns'][1Ps'][1P'][1P] 
[K[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C
[?2004ltotal 12
drwxrwxr-x 3 rsshabanov rsshabanov 4096 Oct 21 19:28 [0m[01;34m.[0m
drwxrwxr-x 6 rsshabanov rsshabanov 4096 Oct 22 12:33 [01;34m..[0m
drwxrwxr-x 4 rsshabanov rsshabanov 4096 Oct 22 12:33 [01;34mansible_collections[0m
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ ls -la /home/rsshabanov/.ansible/collections/ansible_collections/
[?2004ltotal 16
drwxrwxr-x 4 rsshabanov rsshabanov 4096 Oct 22 12:33 [0m[01;34m.[0m
drwxrwxr-x 3 rsshabanov rsshabanov 4096 Oct 21 19:28 [01;34m..[0m
drwxrwxr-x 3 rsshabanov rsshabanov 4096 Oct 22 12:33 [01;34mkubernetes[0m
drwxr-xr-x 2 rsshabanov rsshabanov 4096 Oct 22 12:33 [01;34mkubernetes.core-5.0.0.info[0m
[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ sudo nano ansible.cfg
[?2004l[sudo] password for rsshabanov: 
[?2004h[?1049h[22;0;0t[1;55r(B[m[4l[?7h[39;49m[?1h=[?1h=[?25l[39;49m(B[m[H[2J[53;97H(B[0;7m[ New File ](B[m[H(B[0;7m  GNU nano 6.2                                                                                     ansible.cfg                                                                                              [1;203H(B[m[54d(B[0;7m^G(B[m Help[54;18H(B[0;7m^O(B[m Write Out     (B[0;7m^W(B[m Where Is[52G(B[0;7m^K(B[m Cut[54;69H(B[0;7m^T(B[m Execute[86G(B[0;7m^C(B[m Location[103G(B[0;7mM-U(B[m Undo[54;120H(B[0;7mM-A(B[m Set Mark     (B[0;7mM-](B[m To Bracket   (B[0;7mM-Q(B[m Previous     (B[0;7m^B(B[m Back[54;188H(B[0;7m^‚óÇ(B[m Prev Word[55d(B[0;7m^X(B[m Exit[55;18H(B[0;7m^R(B[m Read File     (B[0;7m^\(B[m Replace[52G(B[0;7m^U(B[m Paste[55;69H(B[0;7m^J(B[m Justify[86G(B[0;7m^/(B[m Go To Line    (B[0;7mM-E(B[m Redo[55;120H(B[0;7mM-6(B[m Copy[55;137H(B[0;7m^Q(B[m Where Was     (B[0;7mM-W(B[m Next[55;171H(B[0;7m^F(B[m Forward[188G(B[0;7m^‚ñ∏(B[m Next Word[2d[?12l[?25h[?25l[1;112H(B[0;7m*[53d(B[m[K[1;203H[2d(B[0;1m[32m[defaults][3d[39m(B[mcollections_paths = /home/rsshabanov/.ansible/collections:/usr/share/ansible/collections[4d[?12l[?25h[?25l[?12l[?25h[3;89H[?25l[53d(B[0;7mSave modified buffer?                                                                                                                                                                                       [54;1H Y(B[m Yes[K[55d(B[0;7m N(B[m No  [55;17H(B[0;7m^C(B[m Cancel[K[53;23H[?12l[?25h[?25l[54d(B[0;7m^G(B[m Help[54;52H(B[0;7mM-D(B[m DOS Format[54;103H(B[0;7mM-A(B[m Append[54;154H(B[0;7mM-B(B[m Backup File[55d(B[0;7m^C(B[m Cancel[17G         [55;52H(B[0;7mM-M(B[m Mac Format[55;103H(B[0;7mM-P(B[m Prepend[55;154H(B[0;7m^T(B[m Browse[53d(B[0;7mFile Name to Write: ansible.cfg(B[m[?12l[?25h[?25l[53;95H[1K (B[0;7m[ Writing... ](B[m[K[1;112H(B[0;7m [203G(B[m[53;94H(B[0;7m[ Wrote 2 lines ](B[m[J[55d[?12l[?25h[55;1H[?1049l[23;0;0t[?1l>[?2004l[?2004h]0;rsshabanov@MSK-01: ~/codeby-devops/exam/src[01;32mrsshabanov@MSK-01[00m:[01;34m~/codeby-devops/exam/src[00m$ sudo nano Jenkinsfile 
[?2004l[?2004h[?1049h[22;0;0t[1;55r(B[m[4l[?7h[39;49m[?1h=[?1h=[?25l[39;49m(B[m[H[2J[53;96H(B[0;7m[ Reading... ](B[m[53;94H(B[0;7m[ Read 72 lines ](B[m[H(B[0;7m  GNU nano 6.2                                                                                     Jenkinsfile                                                                                              [1;203H(B[m[54d(B[0;7m^G(B[m Help[54;18H(B[0;7m^O(B[m Write Out     (B[0;7m^W(B[m Where Is[52G(B[0;7m^K(B[m Cut[54;69H(B[0;7m^T(B[m Execute[86G(B[0;7m^C(B[m Location[103G(B[0;7mM-U(B[m Undo[54;120H(B[0;7mM-A(B[m Set Mark     (B[0;7mM-](B[m To Bracket   (B[0;7mM-Q(B[m Previous     (B[0;7m^B(B[m Back[54;188H(B[0;7m^‚óÇ(B[m Prev Word[55d(B[0;7m^X(B[m Exit[55;18H(B[0;7m^R(B[m Read File     (B[0;7m^\(B[m Replace[52G(B[0;7m^U(B[m Paste[55;69H(B[0;7m^J(B[m Justify[86G(B[0;7m^/(B[m Go To Line    (B[0;7mM-E(B[m Redo[55;120H(B[0;7mM-6(B[m Copy[55;137H(B[0;7m^Q(B[m Where Was     (B[0;7mM-W(B[m Next[55;171H(B[0;7m^F(B[m Forward[188G(B[0;7m^‚ñ∏(B[m Next Word[2dpipeline {[3;5Hagent any[5;5Henvironment {[6;9HappVersion = readFile('exam/src/VERSION').trim()[7;5H}[9dstages {[10;9Hstage('Checkout') {[11;13Hsteps {[12;17Hgit branch: 'exam', url: '[94mhttps://github.com/Roma-uuu/codeby-devops.git'[13;13H[39m(B[m}[14;9H}[15dstage('Build') {[16;13Hsteps {[17;17Hdir('exam/src') {[18;21Hsh 'mvn clean package -Dcheckstyle.skip=true'[19;17H}[20;13H}[21;9H}[22dstage('Test Docker Access') {[23;13Hsteps {[24;17Hsh 'docker info'[25;13H}[26;9H}[27dstage('Build and Push Docker Image') {[28;13Hsteps {[29;17Hdir('exam/src') {[30;21Hscript {[31;25Hecho "Building Docker image with tag: ${appVersion}"[32;25HwithCredentials([usernamePassword(credentialsId: 'dockerhub-credentials', usernameVariable: 'DOCKERHUB_USERNAME', passwordVariable: 'DOCKERHUB_TOKEN')]) {[33;29Hsh """[34;29Hecho $DOCKERHUB_TOKEN | docker login -u $DOCKERHUB_USERNAME --password-stdin[35;29Hdocker build -t apkerigz/devops:${appVersion} .[36;29Hdocker push apkerigz/devops:${appVersion}[37;29H"""[38;25H}[39;21H}[40;17H}[41;13H}[42;9H}[43dstage('Deploy using Helm') {[44;13Hsteps {[45;17HwithCredentials([string(credentialsId: 'k8s-sa-token', variable: 'K8S_TOKEN')]) {[46;21Hdir('exam/src/mychart') {[47;25Hscript {[48;29Hecho "Deploying Helm chart with image tag: ${appVersion}"[49;29Hsh """[50;29Hhelm upgrade --install petclinic-app . \[51;33H--set image.repository=apkerigz/devops \[52;33H--set image.tag=${appVersion} \[2d[?12l[?25h[?25l[1;112H(B[0;7m*[203G(B[m[2;53r[53;1H
[1;55r[52;33H--kube-token=$K8S_TOKEN[K[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;29H"""[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;25H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;21H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;17H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;13H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;9H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;9Hstage('Run Ansible Playbook') {[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;13Hsteps {[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;17Hdir('exam/src') {[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;21Hscript {[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;25H// –î–æ–±–∞–≤–ª—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø–ª–µ–π–±—É–∫–∞[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;25Hsh 'ansible-galaxy collection install kubernetes.core'[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;25H// –ó–∞–ø—É—Å–∫ —Å–∞–º–æ–≥–æ –ø–ª–µ–π–±—É–∫–∞[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;25Hsh 'ansible-playbook -i inventory monitoring_playbook.yml --ask-become-pass'[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;21H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;17H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;13H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;9H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;5H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[52;1H}[2d[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[2;53r[53;1H
[1;55r[2;1H[?12l[?25h[?25l[K[?12l[?25h[?25l[53;93H(B[0;7m[ Nothing was cut ](B[m[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[53;112H[?12l[?25h[2d[?25l[2;29H"""[3;25H}[4;21H}[5;17H}[6;13H}[7;9H}[8dstage('Run Ansible Playbook') {[9;13Hsteps {[10;17Hdir('exam/src') {[11;21Hscript {[12;25H// –°–æ–∑–¥–∞–Ω–∏–µ ansible.cfg –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø—É—Ç–∏ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º[13;25Hsh '''[14;25Hecho "[defaults]" > ansible.cfg[15;25Hecho "collections_paths = /home/rsshabanov/.ansible/collections:/usr/share/ansible/collections" >> ansible.cfg[16;25H'''[18;25H// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫ –ø–ª–µ–π–±—É–∫–∞[19;25Hsh 'ansible-galaxy collection install kubernetes.core'[20;25Hsh 'ansible-playbook -i inventory monitoring_playbook.yml --ask-become-pass'[21;21H}[22;17H}[23;13H}[24;9H}[25;5H}[26d}[53d[K[27d[?12l[?25h[?25l[?12l[?25h[18d[?25l[2dpipeline {[K[3;5Hagent any[K[4d[K[5;5Henvironment {[6;9HappVersion = readFile('exam/src/VERSION').trim()[7;5H}[K[8d[K[9;5Hstages {[K[10;9Hstage('Checkout') {[K[11;13Hsteps {[K[12;17Hgit branch: 'exam', url: '[94mhttps://github.com/Roma-uuu/codeby-devops.git'[13;13H[39m(B[m}[K[14;9H}[K[15dstage('Build') {[K[16;13Hsteps {[K[17;17Hdir('exam/src') {[18;21Hsh 'mvn clean package -Dcheckstyle.skip=true'[19;17H}[K[20;13H}[K[21;9H}[K[22dstage('Test Docker Access') {[23;13Hsteps {[24;16H[1K sh 'docker info'[25;12H[1K }[26;8H[1K }[27dstage('Build and Push Do